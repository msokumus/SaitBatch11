public with sharing class YoutubeApiOutbound {
    public static void ApiOutbound(String videoName, String videoId) {

        // https://console.developers.google.com/ Bu adresten New Project olustur. Project icine gir. Credentials dan API key olustur.
        // Enable APIs and Services / YouTube Data API v3 / Manage / Try In API explorer / Videos / list / Part = statistics, 
        // id = bir youtube video id sini yaz. API key i secerek execute et.  
        // Show Code / cURL/ yukaridaki url adresi kopyala ve end point yap. API keyi adresin en sonuna yapistir.
        // Show code / JSON / alttaki JSON kisim icin wrapper class olustur. JSON verisi en altta mevcut. 

        // video id yi tirnak icine alip sildik yerine videoId parametresi koyduk boylece adresi dinamik yaptik.
        // 'https://youtube.googleapis.com/youtube/v3/videos?part=statistics&id='87PyVddC60s'&key=AIzaSyDhF8z4xOS3PLdzWJvrMkSnNC2fkcHJeI8'

        Http httpObject = new Http();
        HttpRequest request = new HttpRequest();
        request.setEndpoint('https://youtube.googleapis.com/youtube/v3/videos?part=statistics&id=' + videoId + '&key=AIzaSyDhF8z4xOS3PLdzWJvrMkSnNC2fkcHJeI8');
        request.setMethod('GET');
        HttpResponse response = httpObject.send(request);
        // String responseBody = response.getBody(); // if icine aldik.

        if (response.getStatusCode()==200){
            String responseBody = response.getBody();
            YoutubeWrapper yw = (YoutubeWrapper) JSON.deserialize( responseBody, youtubeWrapper.class);
            Youtube_Video_Detail__c yvideo = new Youtube_Video_Detail__c();
            yvideo.Number_of_Like__c = yw.items[0].statistics.likeCount;
            yvideo.Number_of_View__c = yw.items[0].statistics.viewCount;
            yvideo.Video_Id__c = videoId;
            yvideo.Name = videoName;
            insert yvideo;
            }
}
    public class YoutubeWrapper {
        public string kind;
        public string etag;
        public list<ItemWrapper> items;
    }
    public class ItemWrapper {  
        public string kind;
        public string etag;
        public StatisticWrapper statistics;
    }
    public class StatisticWrapper {
        public string viewCount;
        public string likeCount;
        public string favoriteCount;
        public string commentCount;
    }
}
//* YoutubeApiOutbound.ApiOutbound('Korsika','buAhI_L7Dt0&ab_channel');




/*
// Youtube API den gelen JSON verisi asagidaki gibidir

    {
        "kind": "youtube#videoListResponse",
        "etag": "f7eAwbaNo8TdmucDKtdYuTFNwaw",
        "items": [{
            "kind": "youtube#video",
            "etag": "d6ogGPkWi_LsTUKhyNCjYy-E49k",
            "id": "87PyVddC60s",
            "statistics": {
                "viewCount": "552724",
                "likeCount": "13925",
                "favoriteCount": "0",
                "commentCount": "1212"
            }
        }],
        "pageInfo": {
            "totalResults": 1,
            "resultsPerPage": 1
        }
    }

// https://jsonlint.com/                //bu adreste jSON inceledik wrapper nasil olusturulur onu dusunuyoruz.
// https://json2apex.herokuapp.com/     //Bu adresten JSON datasini wrapper class otomatik ceviriyoruz. 

// Generated by JSON2Apex http://json2apex.herokuapp.com/

    public class JSON2Apex {

        public class PageInfo {
            public Integer totalResults;
            public Integer resultsPerPage;
        }

        public String kind;
        public String etag;
        public List<Items> items;
        public PageInfo pageInfo;

        public class Items {
            public String kind;
            public String etag;
            public String id;
            public Statistics statistics;
        }

        public class Statistics {
            public String viewCount;
            public String likeCount;
            public String favoriteCount;
            public String commentCount;
        }

        
        public static JSON2Apex parse(String json) {
            return (JSON2Apex) System.JSON.deserialize(json, JSON2Apex.class);
        }
    }
*/